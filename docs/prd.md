# Very-Jump 轻量级跳板机产品需求文档 (PRD)

## 产品概述

### 产品名称
Very-Jump 轻量级跳板机

### 产品定位
为中小团队提供轻量级、易部署的服务器访问管理解决方案

### 目标用户
- 需要管理 10-50 台服务器的运维团队
- 需要安全访问云服务器和内网服务器的开发团队
- 需要审计和监控服务器访问的安全团队

## 功能需求

### FR1: 用户管理系统

#### FR1.1 用户认证
- **描述**: 提供基于用户名密码的认证机制
- **验收标准**:
  - 用户可以使用用户名和密码登录系统
  - 登录成功后获得 JWT Token
  - Token 有效期为 24 小时
  - 支持自动续期机制
  - 登录失败显示明确错误信息

#### FR1.2 用户管理
- **描述**: 管理员可以管理系统用户
- **验收标准**:
  - 管理员可以创建、编辑、删除用户
  - 支持用户角色设置（admin/user）
  - 用户密码采用 bcrypt 加密存储
  - 用户列表支持分页和搜索
  - 删除用户时需要确认操作

### FR2: 服务器管理系统

#### FR2.1 服务器信息管理
- **描述**: 管理目标服务器的连接信息
- **验收标准**:
  - 支持添加服务器（名称、主机、端口、用户名、密码）
  - 支持编辑和删除服务器信息
  - 服务器密码加密存储
  - 支持连接测试功能
  - 服务器列表支持分页和搜索

#### FR2.2 服务器分组
- **描述**: 对服务器进行分类管理
- **验收标准**:
  - 支持为服务器设置标签
  - 支持按标签筛选服务器
  - 支持批量操作服务器

### FR3: 权限管理系统

#### FR3.1 用户服务器权限
- **描述**: 控制用户对特定服务器的访问权限
- **验收标准**:
  - 管理员可以为用户分配服务器访问权限
  - 支持权限级别：只读、读写
  - 用户只能看到有权限的服务器
  - 支持批量权限分配
  - 权限变更立即生效

#### FR3.2 操作权限控制
- **描述**: 在 SSH 会话中控制用户操作权限
- **验收标准**:
  - 只读权限用户无法执行危险命令
  - 记录所有权限检查结果
  - 权限不足时显示友好提示

### FR4: SSH 代理系统

#### FR4.1 SSH 连接代理
- **描述**: 通过 Web 界面安全连接到目标服务器
- **验收标准**:
  - 用户点击服务器后建立 SSH 连接
  - 通过 WebSocket 实现实时终端交互
  - 支持终端大小调整
  - 支持中文字符显示
  - 连接失败显示详细错误信息

#### FR4.2 多会话管理
- **描述**: 支持用户同时连接多台服务器
- **验收标准**:
  - 用户可以同时打开多个 SSH 会话
  - 支持会话标签页切换
  - 支持会话重命名
  - 支持强制断开会话
  - 会话状态实时显示

### FR5: 会话录制系统

#### FR5.1 会话录制
- **描述**: 自动录制用户的 SSH 操作过程
- **验收标准**:
  - 所有 SSH 会话自动开始录制
  - 录制文件采用标准格式存储
  - 录制不影响终端操作性能
  - 支持录制文件压缩
  - 录制失败不影响正常连接

#### FR5.2 会话回放
- **描述**: 支持回放历史会话录制
- **验收标准**:
  - 提供会话历史列表
  - 支持在线回放会话录制
  - 回放支持暂停、快进、后退
  - 回放速度可调节
  - 支持搜索特定时间点

### FR6: 审计日志系统

#### FR6.1 操作日志
- **描述**: 记录用户在系统中的所有操作
- **验收标准**:
  - 记录用户登录、登出操作
  - 记录服务器管理操作
  - 记录权限变更操作
  - 记录 SSH 连接建立和断开
  - 日志包含时间戳、用户、操作、IP 地址

#### FR6.2 日志查询
- **描述**: 提供日志查询和分析功能
- **验收标准**:
  - 支持按时间范围查询日志
  - 支持按用户筛选日志
  - 支持按操作类型筛选日志
  - 支持关键字搜索
  - 日志列表支持分页显示

### FR7: 系统管理

#### FR7.1 系统设置
- **描述**: 系统级配置管理
- **验收标准**:
  - 支持设置 JWT Token 有效期
  - 支持设置会话超时时间
  - 支持设置录制文件保留时间
  - 支持设置并发连接数限制
  - 配置变更需要重启生效

#### FR7.2 系统监控
- **描述**: 监控系统运行状态
- **验收标准**:
  - 显示当前活跃会话数
  - 显示系统资源使用情况
  - 显示数据库大小和会话录制占用空间
  - 支持系统健康检查接口

## 非功能需求

### NFR1: 性能需求
- **并发用户**: 支持 20+ 并发用户
- **并发会话**: 支持 50+ 并发 SSH 会话
- **响应时间**: Web 界面响应时间 < 2 秒
- **终端延迟**: SSH 终端操作延迟 < 100ms
- **文件大小**: 单个录制文件大小 < 100MB

### NFR2: 可用性需求
- **系统可用性**: 99.5% 可用性（允许每月停机 3.6 小时）
- **数据完整性**: 100% 数据完整性保证
- **故障恢复**: 系统故障后 5 分钟内自动恢复
- **备份恢复**: 支持数据备份和恢复

### NFR3: 安全需求
- **认证安全**: 密码强度检查，密码加密存储
- **传输安全**: 所有通信使用 HTTPS/WSS
- **访问控制**: 基于角色的访问控制
- **审计要求**: 完整的操作审计链路

### NFR4: 可维护性需求
- **代码质量**: Go 代码覆盖率 > 80%
- **日志记录**: 结构化日志记录
- **错误处理**: 完善的错误处理和恢复机制
- **文档完整**: API 文档和用户手册

### NFR5: 可移植性需求
- **容器化**: 完全容器化部署
- **数据隔离**: 所有数据存储在挂载目录
- **环境无关**: 支持各种 Linux 发行版
- **资源占用**: 内存占用 < 512MB，CPU 占用 < 50%

## 产品界面需求

### UI1: 登录界面
- 简洁的登录表单（用户名、密码）
- 登录状态反馈
- 错误信息提示
- 系统 Logo 和版本信息

### UI2: 主控制台
- 顶部导航栏（用户信息、登出）
- 左侧菜单（服务器、会话、用户、日志、设置）
- 主内容区域
- 响应式设计，支持移动端

### UI3: 服务器管理界面
- 服务器列表（表格形式）
- 添加/编辑服务器对话框
- 连接测试按钮
- 批量操作工具栏

### UI4: SSH 终端界面
- 全屏终端模拟器
- 会话标签页
- 连接状态指示器
- 会话控制按钮（断开、录制）

### UI5: 会话历史界面
- 会话列表（时间、用户、服务器、时长）
- 回放控制器
- 搜索和过滤功能

### UI6: 用户管理界面
- 用户列表和权限展示
- 用户添加/编辑表单
- 权限分配界面

### UI7: 审计日志界面
- 日志列表（时间、用户、操作、详情）
- 高级搜索功能
- 日志导出功能

## 数据需求

### 数据存储
- **用户数据**: 用户信息、角色、权限
- **服务器数据**: 服务器连接信息（密码加密）
- **会话数据**: 会话记录、录制文件路径
- **日志数据**: 操作日志、审计记录

### 数据备份
- 支持 SQLite 数据库备份
- 支持会话录制文件备份
- 支持配置文件备份

### 数据保留
- 会话录制默认保留 30 天
- 操作日志默认保留 90 天
- 支持配置数据保留期限

## 集成需求

### INT1: Docker 集成
- 提供官方 Docker 镜像
- 支持 Docker Compose 一键部署
- 支持环境变量配置

### INT2: 数据迁移
- 支持从其他跳板机系统导入数据
- 支持数据导出功能
- 提供数据迁移工具

## 验收标准

### 功能验收
- [ ] 所有功能需求 100% 实现
- [ ] 所有 UI 界面符合设计要求
- [ ] 所有 API 接口测试通过

### 性能验收
- [ ] 并发性能测试通过
- [ ] 响应时间符合要求
- [ ] 资源占用符合限制

### 安全验收
- [ ] 安全扫描无高危漏洞
- [ ] 权限控制测试通过
- [ ] 数据加密验证通过

## 发布计划

### MVP 版本 (v0.1.0)
- 基础用户认证
- 服务器管理
- SSH 代理连接
- 简单的 Web 界面

### 完整版本 (v1.0.0)
- 会话录制和回放
- 完整权限管理
- 审计日志系统
- 完善的 Web 界面

### 增强版本 (v1.1.0)
- 性能优化
- 高级搜索功能
- 数据导入导出
- 监控报警

---

**版本**: v1.0  
**创建时间**: 2024年12月  
**最后更新**: 2024年12月  
**负责人**: 产品开发团队
